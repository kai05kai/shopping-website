<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="~{fragments/head :: head(pageTitle='添加商品')}">
</head>
<body>
    <!-- 导航栏 -->
    <div th:replace="~{fragments/navbar :: navbar}"></div>
    
    <div class="container mt-5 pt-4">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card shadow">
                    <div class="card-header bg-primary text-white">
                        <h4 class="mb-0"><i class="bi bi-plus-circle"></i> 添加新商品</h4>
                    </div>
                    <div class="card-body">
                        <!-- 显示消息 -->
                        <div th:if="${success}" class="alert alert-success alert-dismissible fade show">
                            <i class="bi bi-check-circle"></i> <span th:text="${success}"></span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        
                        <div th:if="${error}" class="alert alert-danger alert-dismissible fade show">
                            <i class="bi bi-exclamation-triangle"></i> <span th:text="${error}"></span>
                            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                        </div>
                        
                        <!-- 添加商品表单 -->
                        <form th:action="@{/products/add}" method="post" enctype="multipart/form-data" 
                              th:object="${product}">
                            
                            <!-- 商品名称 -->
                            <div class="mb-3">
                                <label for="name" class="form-label">商品名称 *</label>
                                <input type="text" class="form-control" id="name" 
                                       th:field="*{name}" placeholder="请输入商品名称" required>
                                <div th:if="${#fields.hasErrors('name')}" class="invalid-feedback d-block">
                                    <span th:errors="*{name}"></span>
                                </div>
                            </div>
                            
                            <!-- 商品描述 -->
                            <div class="mb-3">
                                <label for="description" class="form-label">商品描述</label>
                                <textarea class="form-control" id="description" 
                                          th:field="*{description}" rows="3" 
                                          placeholder="请输入商品描述..."></textarea>
                            </div>
                            
                            <!-- 价格 -->
                            <div class="mb-3">
                                <label for="price" class="form-label">价格 *</label>
                                <div class="input-group">
                                    <span class="input-group-text">¥</span>
                                    <input type="number" class="form-control" id="price" 
                                           th:field="*{price}" step="0.01" min="0" 
                                           placeholder="0.00" required>
                                </div>
                                <div th:if="${#fields.hasErrors('price')}" class="invalid-feedback d-block">
                                    <span th:errors="*{price}"></span>
                                </div>
                            </div>
                            
                            <!-- 库存 -->
                            <div class="mb-3">
                                <label for="stockQuantity" class="form-label">库存数量</label>
                                <input type="number" class="form-control" id="stockQuantity" 
                                       th:field="*{stockQuantity}" min="0" value="0">
                                <div class="form-text">设置为0表示缺货</div>
                            </div>
                            
                            <!-- 商品图片 -->
                            <div class="mb-4">
                                <label for="imageFile" class="form-label">商品图片</label>
                                <input type="file" class="form-control" id="imageFile" 
                                       name="imageFile" accept="image/*">
                                <div class="form-text">
                                    支持 JPG, PNG 格式，最大 5MB。如果不选择图片，将使用默认图片。
                                </div>
                            </div>
                            
                            <!-- 提交按钮 -->
                            <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                <a href="/products/my-products" class="btn btn-secondary me-md-2">
                                    <i class="bi bi-arrow-left"></i> 返回
                                </a>
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-check-circle"></i> 添加商品
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- 添加商品提示 -->
                <div class="alert alert-info mt-4">
                    <h6><i class="bi bi-lightbulb"></i> 添加商品提示</h6>
                    <ul class="mb-0">
                        <li>商品名称要简洁明了，突出商品特点</li>
                        <li>高质量的商品图片能显著提高销量</li>
                        <li>合理定价可以参考同类商品的市场价格</li>
                        <li>准确的库存管理能避免订单问题</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 页脚 -->
    <div th:replace="~{fragments/footer :: footer}"></div>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            console.log('添加商品页面已加载');
            
            // 表单验证
            const form = document.querySelector('form');
            const nameInput = document.getElementById('name');
            const priceInput = document.getElementById('price');
            
            form.addEventListener('submit', function(e) {
                let isValid = true;
                
                // 验证商品名称
                if (!nameInput.value.trim()) {
                    showError(nameInput, '商品名称不能为空');
                    isValid = false;
                } else {
                    clearError(nameInput);
                }
                
                // 验证价格
                if (!priceInput.value || parseFloat(priceInput.value) <= 0) {
                    showError(priceInput, '价格必须大于0');
                    isValid = false;
                } else {
                    clearError(priceInput);
                }
                
                if (!isValid) {
                    e.preventDefault();
                    alert('请检查表单中的错误');
                }
            });
            
            function showError(field, message) {
                field.classList.add('is-invalid');
                field.classList.remove('is-valid');
                
                let errorDiv = field.parentElement.querySelector('.invalid-feedback');
                if (!errorDiv) {
                    errorDiv = document.createElement('div');
                    errorDiv.className = 'invalid-feedback d-block';
                    field.parentElement.appendChild(errorDiv);
                }
                errorDiv.textContent = message;
            }
            
            function clearError(field) {
                field.classList.remove('is-invalid');
                field.classList.add('is-valid');
                
                const errorDiv = field.parentElement.querySelector('.invalid-feedback');
                if (errorDiv) {
                    errorDiv.textContent = '';
                }
            }
        });
    </script>
</body>
</html>